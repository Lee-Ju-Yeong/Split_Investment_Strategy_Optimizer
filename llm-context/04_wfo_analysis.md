# llm-context/04_wfo_analysis.md
# === YAML Front Matter: The Control Panel ===
# μ΄ νμΌμ λ©”νƒ€λ°μ΄ν„°λ¥Ό μ •μν•©λ‹λ‹¤.

topic: "04. Walk-Forward λ¶„μ„: μ „λµ κ°•κ±΄μ„± κ²€μ¦"
project_id: "masicsplit-v1"
status: "in-progress" # (ν•µμ‹¬ λ΅μ§ κ³ λ„ν™” μ§„ν–‰ μ¤‘)
tags:
  - walk-forward-optimization
  - wfo
  - overfitting
  - robustness
  - strategy-validation
  - clustering
model: "ν€€νΈ-J (μ‹λ‹μ–΄ ν€€νΈ μ‹μ¤ν… κ°λ°μ)"
persona: "κ³Όμµμ ν™”λ¥Ό λ°©μ§€ν•κ³  μ „λµμ κ°•κ±΄μ„±μ„ μ •λ‰μ μΌλ΅ κ²€μ¦ν•λ” ν€€νΈ λ¶„μ„κ°€"
created_date: "2025-09-01" # (Based on git log)
last_modified: "2025-09-13" # (Documentation Update)
---

## μ‹μ¤ν… ν”„λ΅¬ν”„νΈ (System Prompt / The Constitution)
<!-- _PROJECT_MASTER.mdμ κ·μΉ™μ„ κ³„μΉν•κ³ , μ΄ μ£Όμ μ— νΉν™”λ λ©ν‘λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤. -->

### π― λ©ν‘ (Objective)
- Walk-Forward Optimization(WFO) ν”„λ μ„μ›ν¬λ¥Ό ν†µν•΄, ν¬μ μ „λµμ΄ κ³Όκ±° λ°μ΄ν„°μ— κ³Όμµμ ν™”λμ§€ μ•μ•λ”μ§€ κ²€μ¦ν•κ³ , λ‹¤μ–‘ν• μ‹μ¥ κµ­λ©΄μ—μ„μ ν„μ‹¤μ μΈ κΈ°λ€ μ„±κ³Όλ¥Ό μΈ΅μ •ν•λ‹¤.
- **[ν•µμ‹¬]** κ° ν•™μµ(IS) κµ¬κ°„μ—μ„ 'μµκ³  μ„±κ³Ό'κ°€ μ•„λ‹, **'κ°€μ¥ κ°•κ±΄ν•(Robust) νλΌλ―Έν„° κµ°μ§‘(Cluster)'**μ„ ν†µκ³„μ μΌλ΅ μ°Ύμ•„λ‚΄μ–΄, μ „λµμ μ‹¤μ „ μƒμ΅΄ κ°€λ¥μ„±μ„ κ·Ήλ€ν™”ν•λ‹¤.

## π”„ λ΅¤λ§ μ”μ•½ λ° ν•µμ‹¬ κ²°μ •μ‚¬ν•­ (Rolling Summary / The Living Memory)
<!-- μ΄ μ£Όμ  λ‚΄μ—μ„μ ν•µμ‹¬ κ²°μ • μ‚¬ν•­μ„ μ”μ•½ν•©λ‹λ‹¤. -->

- (μ‹κΈ° λ―Έμƒ): **WFO λ¨λΈ μ±„νƒ:** **'μ μ•½μ΅°κ±΄ κΈ°λ°μ μ μ–΄λ κ²ΉμΉ¨(Constraint-based Controlled Overlap)'** λ¨λΈμ„ μ±„νƒν•μ—¬, μ ν•λ λ°μ΄ν„° κΈ°κ°„ λ‚΄μ—μ„ λ¶„μ„μ ν„μ‹¤μ„±κ³Ό ν¨μ¨μ„±μ„ λ¨λ‘ ν™•λ³΄.
- (μ‹κΈ° λ―Έμƒ): **μ•„ν‚¤ν…μ² μ„¤κ³„:** **'μ¤μΌ€μ¤νΈλ μ΄ν„°-μ›μ»¤'** μ•„ν‚¤ν…μ²λ¥Ό μ±„νƒ. (`walk_forward_analyzer.py`, `parameter_simulation_gpu.py`, `debug_gpu_single_run.py`)
- (2025-09-04): **μ„¤μ • κ°„μ†ν™”:** `config.yaml`μ WFO μ„¤μ •μ„ `total_folds`μ™€ `period_length_days` λ‹¨ λ‘ κ°λ΅ λ‹¨μν™”ν•μ—¬, μ‚¬μ©μ νΈμμ„±κ³Ό μ„¤μ •μ λ…ν™•μ„±μ„ κ·Ήλ€ν™”.
- (2025-09-06): **[ν•µμ‹¬ λ°©λ²•λ΅  μ§„ν™”]** WFOμ λ©ν‘λ¥Ό 'μµκ³  μ„±κ³Ό(λΎ°μ΅±ν• μ‚°λ΄‰μ°λ¦¬) νλΌλ―Έν„° μ°ΎκΈ°'μ—μ„, **κ° IS μ‹λ®¬λ μ΄μ… κ²°κ³Ό μ „μ²΄λ¥Ό ν†µκ³„μ μΌλ΅ λ¶„μ„ν•μ—¬ 'κ°€μ¥ κ°•κ±΄ν• νλΌλ―Έν„° κµ°μ§‘(λ„“κ³  λ†’μ€ κ³ μ›)'μ μ¤‘μ‹¬μ„ μ°Ύλ” λ°©μ‹**μΌλ΅ μµμΆ… ν™•μ •.

## π›οΈ ν•µμ‹¬ μ •λ³΄ λ° λ΅μ§ (Key Information & Core Logic)
<!-- μ΄ μ£Όμ μ μ•„ν‚¤ν…μ², λ°μ΄ν„° νλ¦„, λ¨λ“λ³„ μ—­ν• μ„ μ„¤λ…ν•©λ‹λ‹¤. -->

### 1. μ„¤κ³„ μ‚¬μƒ: "μµκ³ "κ°€ μ•„λ‹ "μµμ„ "μ„ μ°Ύλ” μ—¬μ •

WFOλ” κ³Όκ±° λ°μ΄ν„°λ΅ ν•™μµ(In-Sample)ν•κ³ , ν•™μµμ— μ‚¬μ©λμ§€ μ•μ€ λ―Έλ λ°μ΄ν„°λ΅ κ²€μ¦(Out-of-Sample)ν•λ” κ³Όμ •μ„ λ°λ³µν•μ—¬ κ³Όμµμ ν™”λ¥Ό λ°©μ§€ν•©λ‹λ‹¤. μ°λ¦¬ μ‹μ¤ν…μ€ μ—¬κΈ°μ„ ν• λ‹¨κ³„ λ” λ‚μ•„κ°€, ν•™μµ κ³Όμ •μ—μ„ λ‹¨μν '1λ“±'μ„ λ½‘λ” κ²ƒμ΄ μ•„λ‹λΌ, **μ„±κ³Όκ°€ μΆ‹μ€ νλΌλ―Έν„°λ“¤μ΄ ν•μ„±ν•λ” μ•μ •μ μΈ 'κ³ μ›'μ„ μ°Ύμ•„λƒ…λ‹λ‹¤.**

**κ³ λ„ν™”λ WFO ν”„λ΅μ„Έμ¤:**
1.  **ν•™μµ (In-Sample):** κ³Όκ±° νΉμ • κΈ°κ°„μ— λ€ν•΄ μμ² κ°μ νλΌλ―Έν„° μ΅°ν•©μΌλ΅ μ‹λ®¬λ μ΄μ…μ„ μ‹¤ν–‰ν•λ‹¤.
2.  **κ°•κ±΄μ„± λ¶„μ„ (Robustness Analysis):** μ‹λ®¬λ μ΄μ… κ²°κ³Ό μ „μ²΄λ¥Ό ν†µκ³„μ μΌλ΅ λ¶„μ„(μ: ν΄λ¬μ¤ν„°λ§)ν•μ—¬, μ„±κ³Όκ°€ μ•μ •μ μΌλ΅ λ†’μ€ **'νλΌλ―Έν„° κµ°μ§‘'μ μ¤‘μ‹¬κ°’**μ„ κ°€μ¥ κ°•κ±΄ν• νλΌλ―Έν„°λ΅ λ„μ¶ν•λ‹¤.
3.  **κ²€μ¦ (Out-of-Sample):** μ„μ—μ„ μ°Ύμ€ **'κ°•κ±΄ν•' νλΌλ―Έν„°**λ¥Ό λ‹¤μ OOS κΈ°κ°„μ— μ μ©ν•μ—¬ μ‹¤μ  μ„±κ³Όλ¥Ό ν…μ¤νΈν•λ‹¤.
4.  **μ΄λ™ (Walk Forward):** μ΄ κ³Όμ •μ„ λ¨λ“  Foldμ— κ±Έμ³ λ°λ³µν•μ—¬, **'κ°•κ±΄ν• νλΌλ―Έν„°λ΅λ§ μ΄μν–μ„ λ•'**μ ν„μ‹¤μ μΈ μ¥κΈ° μ„±κ³Όλ¥Ό μµμΆ… μΈ΅μ •ν•λ‹¤.

### 2. ν•µμ‹¬ λ¨λ“ μƒμ„Έ μ„¤λ… (`src/` λ””λ ‰ν† λ¦¬ κΈ°μ¤€)

#### κ°€. `walk_forward_analyzer.py` (Orchestrator)
- **μ—­ν• :** WFO ν”„λ΅μ νΈμ **μ΄μ‚¬λ Ήκ΄€**.
- **ν•µμ‹¬ λ΅μ§ (κ³ λ„ν™”λ λ²„μ „):**
    1.  `config.yaml`μ„ μ½μ–΄ WFO κΈ°κ°„μ„ **μλ™μΌλ΅ μ‚¬μ „ κ³„μ‚°**.
    2.  `total_folds` λ§νΌ `for` λ£¨ν”„λ¥Ό μ‹¤ν–‰.
    3.  **λ£¨ν”„ λ‚΄λ¶€:**
        a. `parameter_simulation_gpu.py`λ¥Ό νΈμ¶ν•μ—¬ IS κΈ°κ°„μ **μ „μ²΄ μ‹λ®¬λ μ΄μ… κ²°κ³Ό DataFrame**μ„ λ°ν™λ°›μ.
        b. **(NEW)** `find_robust_parameters()` ν—¬νΌ ν•¨μλ¥Ό νΈμ¶ν•μ—¬, λ°ν™λ DataFrameμ„ λ¶„μ„ν•κ³  **'κ°•κ±΄ν• νλΌλ―Έν„° μ…‹'**μ„ μ¶”μ¶.
        c. μ¶”μ¶λ 'κ°•κ±΄ν• νλΌλ―Έν„°'λ¥Ό `debug_gpu_single_run.py`μ— μ „λ‹¬ν•μ—¬ **OOS λ°±ν…μ¤νΈ**λ¥Ό μ‹¤ν–‰.
        d. OOS μμµ κ³΅μ„ κ³Ό 'κ°•κ±΄ν• νλΌλ―Έν„°'λ¥Ό λ¦¬μ¤νΈμ— μ €μ¥.
    4.  **λ£¨ν”„ μΆ…λ£ ν›„:** μµμΆ… μμµ κ³΅μ„ κ³Ό **'κ°•κ±΄ν• νλΌλ―Έν„°λ“¤μ μ‹κ³„μ—΄ μ•μ •μ„±'**μ„ μΆ…ν•© λ¶„μ„.

#### λ‚. `parameter_simulation_gpu.py` (Worker 1: Mass Simulator)
- **μ—­ν• :** νΉμ • IS κΈ°κ°„μ— λ€ν• **λ€κ·λ¨ λ³‘λ ¬ μ‹λ®¬λ μ΄μ…μ„ μν–‰ν•κ³ , κ·Έ μ „μ²΄ κ²°κ³Όλ¥Ό λ³΄κ³ ν•λ” 'λ°μ΄ν„° μƒμ‚°μ'**.
- **WFO λ‚΄μ—μ„μ λ™μ‘:** `find_optimal_parameters` ν•¨μλ” μ΄μ  (1λ“± νλΌλ―Έν„°, **μ „μ²΄ μ‹λ®¬λ μ΄μ… κ²°κ³Ό DataFrame**) λ‘ κ°€μ§€λ¥Ό λ¨λ‘ λ°ν™. μ¤μΌ€μ¤νΈλ μ΄ν„°λ” μ΄ μ¤‘ **μ „μ²΄ κ²°κ³Ό DataFrame**μ„ ν•µμ‹¬μ μΌλ΅ μ‚¬μ©.

#### λ‹¤. `debug_gpu_single_run.py` (Worker 2: Backtester)
- **μ—­ν• :** μ¤μΌ€μ¤νΈλ μ΄ν„°λ΅λ¶€ν„° **'κ°•κ±΄ν•' νλΌλ―Έν„°**μ™€ OOS κΈ°κ°„μ„ λ°›μ•„, λ‹¨μΌ λ°±ν…μ¤νΈλ¥Ό μν–‰ν•κ³  κ²°κ³Όλ¥Ό λ³΄κ³ ν•λ” **'μ‹¤ν–‰ μ „λ¬Έκ°€'**. (κΈ°μ΅΄ μ—­ν• κ³Ό λ™μΌ)

#### λΌ. `(μ‹ μ„¤ μμ •)` `robustness_analyzer.py` (Helper: Analyst)
- **μ—­ν• :** `find_robust_parameters`μ™€ κ°™μ€ λ¶„μ„ ν•¨μλ¥Ό ν¬ν•¨ν•λ” **ν†µκ³„ λ¶„μ„ ν—¬νΌ λ¨λ“**.
- **ν•µμ‹¬ λ΅μ§:** ν•„ν„°λ§, ν΄λ¬μ¤ν„°λ§(K-Means), λ¶„ν¬ λ¶„μ„(μ¤‘μ•™κ°’/μµλΉκ°’) λ“±μ λ°©λ²•λ΅ μ„ κµ¬ν„ν•μ—¬, μ‹λ®¬λ μ΄μ… κ²°κ³Όλ΅λ¶€ν„° κ°€μ¥ κ°•κ±΄ν• νλΌλ―Έν„° μ…‹μ„ λ„μ¶.

## π’¬ λ€ν™” κΈ°λ΅ (Conversation Log / The Transcript)
<!-- μ΄ μ£Όμ μ— λ€ν• κµ¬μ²΄μ μΈ λ€ν™”λ” μ΄ νμΌμ—μ„ μ§„ν–‰λ©λ‹λ‹¤. -->

## π“ μ¤ν¬λμΉν¨λ“ (Scratchpad / The Workbench)
<!-- μ΄ μ£Όμ μ™€ κ΄€λ ¨λ μ•„μ΄λ””μ–΄, λ©”λ¨, TODO λ“±μ„ κΈ°λ΅ν•©λ‹λ‹¤. -->

- **ν•µμ‹¬ κ³Όμ :** `find_robust_parameters_from_simulation` ν•¨μλ¥Ό κµ¬ν„ν•κ³  WFO νμ΄ν”„λΌμΈμ— ν†µν•©ν•λ” κ²ƒ.
- **μ—°κµ¬ μ›ν¬ν”λ΅μ°:**
    1.  **[μ—°κµ¬μ‹¤]** Jupyter Notebook(Colab)μ—μ„ λ‹¨μΌ IS μ‹λ®¬λ μ΄μ… κ²°κ³Ό(`.csv`)λ¥Ό λ¶„μ„ν•μ—¬, ν΄λ¬μ¤ν„°λ§ κΈ°λ°μ κ°•κ±΄μ„± νƒμƒ‰ λ°©λ²•λ΅ μ„ ν”„λ΅ν† νƒ€μ΄ν•‘ν•κ³  κ²€μ¦ν•λ‹¤.
    2.  **[μλ™ν™”]** μ—°κµ¬ λ‹¨κ³„μ—μ„ κ²€μ¦λ λ΅μ§(μµμ  k μλ™ μ„ νƒ ν¬ν•¨)μ„ `robustness_analyzer.py` λ¨λ“λ΅ κ°λ°ν•λ‹¤.
    3.  **[ν†µν•©]** `walk_forward_analyzer.py`κ°€ μƒλ΅μ΄ λ¶„μ„ λ¨λ“μ„ νΈμ¶ν•λ„λ΅ μμ •ν•μ—¬, μ „μ²΄ 'κ°•κ±΄μ„± μ¤‘μ‹¬ WFO' νμ΄ν”„λΌμΈμ„ μ™„μ„±ν•λ‹¤.